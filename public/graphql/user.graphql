{
  user {
    login
    firstName
    lastName
    id
    email

    # Total XP up/down for ratio
    totalUp
    totalDown

    # Aggregate of XP transactions in bh-module (excluding piscines)
    transactions_aggregate(
      where: {
        type: { _eq: "xp" }
        path: { _like: "/bahrain/bh-module/%" }
        _not: {
          _or: [
            { path: { _like: "/bahrain/bh-module/piscine-js/%" } }
            { path: { _like: "/bahrain/bh-module/piscine-rust/%" } }
          ]
        }
      }
    ) {
      aggregate {
        sum {
          amount
        }
      }
    }

    # Latest 10 XP transactions (no filter, same as before)
    transactions(
      where: { type: { _eq: "xp" } }
      order_by: { createdAt: desc }
      limit: 10
    ) {
      amount
      createdAt
      path
    }

    # Top 10 XP transactions by amount
    topTransactions: transactions(
      where: { type: { _eq: "xp" } }
      order_by: { amount: desc }
      limit: 10
    ) {
      amount
      createdAt
      path
    }

    # Top skills (distinct per skill type)
    topSkills: transactions(
      where: { type: { _like: "skill_%" } }
      distinct_on: type
      order_by: [{ type: asc }, { amount: desc }]
    ) {
      type
      amount
    }
  }
}
